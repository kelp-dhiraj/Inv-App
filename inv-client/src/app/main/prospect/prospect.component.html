<div fxLayout="row wrap" fxLayout.lt-sm="column" fxLayoutGap="20px" fxLayoutGap.lt-sm="0px" fxLayoutAlign="flex-start" style="align-items: center;">
  <div fxFlex="0 0 calc(75% - 210px)" fxLayoutGap="20px" style="align-items: center;">
    <mat-form-field style="width: calc(100% - 140px)">
      <mat-label>Prospect Name</mat-label>                 
      <input matInput placeholder="Type or doubleclick to show list"
        [(ngModel)]="prospectId" 
        [matAutocomplete]="prospectNameAuto" 
        (keyup)="filterProspectNames()" 
        (change)="prospectNameChange()"
      >
      <mat-autocomplete #prospectNameAuto="matAutocomplete" 
        [displayWith]="prospectNameDisplayFn.bind(this)"
        (optionSelected)="prospectNameChange()"
      >
        <mat-option *ngFor="let item of filteredProspectNames" [value]="item.id">{{item.prospect_name}}</mat-option>
      </mat-autocomplete>
    </mat-form-field>
    <div fxFlex="1 1 100px" style="height: 88px; display: flex; align-items: center;">
      <button mat-button class="btn mat-flat-button"  (click)="getData()">GET DATA</button>
    </div>
  </div>
  <div fxFlex="0 0 calc(25% + 190px)" fxLayoutGap="20px" style="align-items: center;"  *ngIf="prospect">
    <mat-form-field fxFlex="1 1 calc(100% - 210px)">
      <mat-label>Stage</mat-label>
      <mat-select [(ngModel)]="prospect.assessment_stage_code" (ngModelChange)="dataChanged()">
        <mat-option *ngFor="let item of stages$ | async" [value]="item.lookup_code">{{item.lookup_value}}</mat-option>
      </mat-select>
    </mat-form-field>
    <div *ngIf="prospect" fxFlex="1 1 90px" style="height: 88px; display: flex; align-items: center;">
      <button mat-button class="btn mat-flat-button" (click)="saveProspect()">SUBMIT</button>
    </div>
    <div *ngIf="prospect" fxFlex="1 1 80px" style="padding-bottom: 30px;">
      <div class="circle-box">
        <h4>Priority</h4>
        <div class="priority medium">{{prospect.priority_code[0]}}</div>
      </div>
    </div>
  </div>
</div>
<div style="margin-bottom: 20px" *ngIf="prospect">{{prospect.primary_office_city}}, {{prospect.region}} <!-- {{prospect.category_code}}--></div>
<mat-accordion *ngIf="prospect" style="margin-top: 20px">
  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title style="align-items: center;">
        Likelihood Score <span class="panel-badge">Total Score: {{prospectLikelihoodScore}}%</span>
      </mat-panel-title>
    </mat-expansion-panel-header>
    <div class="panel-body">
      <h3>Profiling: </h3>
      <mat-form-field style="width: 300px">
        <mat-label>Ticket Size (M$)</mat-label>                 
        <input matInput placeholder="Enter Ticket Size in Million $" [(ngModel)]="prospect.ticket_size" autocomplete="off" (ngModelChange)="dataChanged()"
        >
      </mat-form-field>
      <div fxLayout="row wrap" fxLayout.lt-sm="column" fxLayoutGap="20px" fxLayoutGap.lt-sm="10px">
        <div fxFlex="1 1 calc(50% - 20px)">India Allocation</div>
        <div fxFlex="1 1 50%">
          <mat-radio-group aria-label="Select an option" class="radio-group" [(ngModel)]="prospect.india_allocation_code" (ngModelChange)="dataChanged()"
            fxLayout="row wrap" fxLayout.lt-sm="column" fxLayoutGap="20px" fxLayoutGap.lt-sm="10px"
          >
            <mat-radio-button *ngFor="let item of indiaAllocCodes$ | async" [value]="item.lookup_code" style="min-width: 80px; ">{{item.lookup_value}}</mat-radio-button>
          </mat-radio-group>
        </div>
      </div>
      <div style="margin-bottom: 20px">
        <mat-form-field style="width: 100%">
          <textarea matInput style="min-height: 20px" placeholder="Comment" [(ngModel)]="prospect.india_allocation_comment" cdkTextareaAutosize (ngModelChange)="dataChanged()"></textarea>
        </mat-form-field>
      </div>
      <div fxLayout="row wrap" fxLayout.lt-sm="column" fxLayoutGap="20px" fxLayoutGap.lt-sm="10px">
        <div fxFlex="1 1 calc(50% - 20px)">Strategic Alignment to India</div>
        <div fxFlex="1 1 50%">
          <mat-radio-group aria-label="Select an option" class="radio-group" [(ngModel)]="prospect.strategic_india_alignment_code" (ngModelChange)="dataChanged()" fxLayout="row wrap" fxLayout.lt-sm="column" fxLayoutGap="20px" fxLayoutGap.lt-sm="10px">
            <mat-radio-button *ngFor="let item of strategicIndiaAlignCodes$ | async" [value]="item.lookup_code" style="min-width: 80px; ">{{item.lookup_value}}</mat-radio-button>
          </mat-radio-group>
        </div>
      </div>
      <div style="margin-bottom: 20px">
        <mat-form-field style="width: 100%">
          <textarea matInput style="min-height: 20px"  placeholder="Comment" [(ngModel)]="prospect.strategic_india_alignment_comment" cdkTextareaAutosize (ngModelChange)="dataChanged()"></textarea>
        </mat-form-field>
      </div>
      <div fxLayout="row wrap" fxLayout.lt-sm="column" fxLayoutGap="20px" fxLayoutGap.lt-sm="10px">
        <div fxFlex="1 1 calc(50% - 20px)">Senior Advocate TN Champion</div>
        <div fxFlex="1 1 50%">
          <mat-radio-group aria-label="Select an option" class="radio-group" [(ngModel)]="prospect.senior_advocate_code" (ngModelChange)="dataChanged()" fxLayout="row wrap" fxLayout.lt-sm="column" fxLayoutGap="20px" fxLayoutGap.lt-sm="10px">
            <mat-radio-button *ngFor="let item of seniorAdvocateCodes$ | async" [value]="item.lookup_code" style="min-width: 80px; ">{{item.lookup_value}}</mat-radio-button>
          </mat-radio-group>
        </div>
      </div>
      <div style="margin-bottom: 20px">
        <mat-form-field style="width: 100%">
          <textarea matInput style="min-height: 20px"  placeholder="Comment" [(ngModel)]="prospect.senior_advocate_comment" cdkTextareaAutosize (ngModelChange)="dataChanged()"></textarea>
        </mat-form-field>
      </div>
      <div fxLayout="row wrap" fxLayout.lt-sm="column" fxLayoutGap="20px" fxLayoutGap.lt-sm="10px">
        <div fxFlex="1 1 calc(50% - 20px)">TN Track record bias</div>
        <div fxFlex="1 1 50%">
          <mat-radio-group aria-label="Select an option" class="radio-group" [(ngModel)]="prospect.tn_track_record_bias_code" (ngModelChange)="dataChanged()" fxLayout="row wrap" fxLayout.lt-sm="column" fxLayoutGap="20px" fxLayoutGap.lt-sm="10px">
            <mat-radio-button *ngFor="let item of tnTrackRecordBiasCodes$ | async" [value]="item.lookup_code" style="min-width: 80px; ">{{item.lookup_value}}</mat-radio-button>
          </mat-radio-group>
        </div>
      </div>
      <div style="margin-bottom: 20px">
        <mat-form-field style="width: 100%">
          <textarea matInput style="min-height: 20px"  placeholder="Comment" [(ngModel)]="prospect.tn_track_record_bias_comment" cdkTextareaAutosize (ngModelChange)="dataChanged()"></textarea>
        </mat-form-field>
      </div>
      <div fxLayout="row wrap" fxLayout.lt-sm="column" fxLayoutGap="20px" fxLayoutGap.lt-sm="10px">
        <div fxFlex="1 1 calc(50% - 20px)">Positive Negative surprise</div>
        <div fxFlex="1 1 50%">
          <mat-radio-group aria-label="Select an option" class="radio-group" [(ngModel)]="prospect.positive_negative_surprise_code" (ngModelChange)="dataChanged()" fxLayout="row wrap" fxLayout.lt-sm="column" fxLayoutGap="20px" fxLayoutGap.lt-sm="10px">
            <mat-radio-button *ngFor="let item of positiveNegativeSurpriseCodes$ | async" [value]="item.lookup_code" style="min-width: 80px; ">{{item.lookup_value}}</mat-radio-button>
          </mat-radio-group>
        </div>
      </div>
      <div style="margin-bottom: 20px">
        <mat-form-field style="width: 100%">
          <textarea matInput style="min-height: 20px"  placeholder="Comment" [(ngModel)]="prospect.positive_negative_surprise_comment" cdkTextareaAutosize (ngModelChange)="dataChanged()"></textarea>
        </mat-form-field>
      </div>
      <div style="display: flex; justify-content: flex-end;">
        <button mat-button class="btn mat-flat-button" (click)="saveProspect()">SUBMIT</button>
      </div>
    </div>
  </mat-expansion-panel>
  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title>
        Interactions
      </mat-panel-title>
    </mat-expansion-panel-header>
    <div class="panel-body">
      <div fxHide.xs *ngIf="prospect.interactions.length > 0">
        <table mat-table [dataSource]="interactionDataSource" style="width: 100%">
          <ng-container matColumnDef="int_type">
            <th mat-header-cell *matHeaderCellDef>Interaction Type</th>
            <td mat-cell *matCellDef="let element">{{element.int_type.lookup_value}}</td>
          </ng-container>
          <ng-container matColumnDef="interaction_date">
            <th mat-header-cell *matHeaderCellDef>Interaction Date</th>
            <td mat-cell *matCellDef="let element">{{element.interaction_date | date:'d MMM y'}}</td>
          </ng-container>
          <ng-container matColumnDef="comments">
            <th mat-header-cell *matHeaderCellDef>Comments</th>
            <td mat-cell *matCellDef="let element">{{element.comments}}</td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="interactionColumns;"></tr>
          <tr mat-row *matRowDef="let row; columns: interactionColumns;"></tr>
        </table>
      </div>
      <mat-accordion fxHide.gt-xs>
        <mat-expansion-panel *ngFor="let item of interactionDataSource.data">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <div style="flex: 1 1 auto">{{item.int_type.lookup_value}}</div> 
              <div style="flex: 0 0 auto; font-size: 10px">{{item.interaction_date | date:'d MMM y'}}</div>
            </mat-panel-title>
          </mat-expansion-panel-header>
          {{item.comments}}
        </mat-expansion-panel>
      </mat-accordion>
      <div style="display: flex; justify-content: flex-end; margin-bottom: 20px" *ngIf="prospect.interactions.length > 3">
        <button mat-button color="primary" (click)="showAllClick()">{{showAllFlag ? 'Show Last 3 Interactions' : 'Show All Interactions' }}</button>
      </div>
      <mat-form-field style="width: 200px;margin-top: 10px" >
        <mat-label>Interaction Type</mat-label>
        <mat-select [(ngModel)]="interactionTypeCode" (ngModelChange)="dataChangedInteraction()">
          <mat-option *ngFor="let item of interactionTypeCodes$ | async" [value]="item.lookup_code">{{item.lookup_value}}</mat-option>
        </mat-select>
      </mat-form-field>
      <div style="margin-bottom: 20px">
        <mat-form-field style="width: 100%">
          <textarea matInput style="min-height: 20px" placeholder="Comment" [(ngModel)]="interactionComment" cdkTextareaAutosize (ngModelChange)="dataChangedInteraction()"></textarea>
        </mat-form-field>
      </div>
      <div style="display: flex; justify-content: flex-end; margin-bottom: 20px">
        <button mat-button class="btn mat-flat-button" (click)="saveInteraction()">SUBMIT</button>
      </div>
      <div fxLayout="row wrap" fxLayout.lt-sm="column" fxLayoutGap="20px" fxLayoutGap.lt-sm="10px">
        <div fxFlex="0 0 calc(50% - 10px)">
          <div style="font-weight: bold">IR Team</div>
          <div fxLayout="row wrap" fxLayout.lt-sm="column" fxLayoutGap="20px" fxLayoutGap.lt-sm="10px">
            <div fxFlex="0 0 50%" style="align-items: center" *ngFor="let s of interactionSummary['IR']">
              <span class="panel-badge" style="margin: 5px 10px 5px 0px">{{s.value}}</span>
              <span fxFlex="1 1 auto">{{s.label}}</span> 
            </div>
          </div>
        </div>
        <div fxFlex="0 0 calc(50% - 10px)">
          <div style="font-weight: bold">Deal Team</div>
          <div fxLayout="row wrap" fxLayout.lt-sm="column" fxLayoutGap="20px" fxLayoutGap.lt-sm="10px">
            <div fxFlex="0 0 50%" style="align-items: center" *ngFor="let s of interactionSummary['DT']">
              <span class="panel-badge" style="margin: 5px 10px 5px 0px">{{s.value}}</span>
              <span fxFlex="1 1 auto">{{s.label}}</span> 
            </div>
          </div>
        </div>
      </div>
    </div>
  </mat-expansion-panel>
  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title>
        Fund Raise
      </mat-panel-title>
    </mat-expansion-panel-header>
    <div class="panel-body">
      <mat-form-field style="width: 300px">
        <mat-label>Fund Raise Stage</mat-label>
        <mat-select [(ngModel)]="prospect.fund_raise_stage_code" (ngModelChange)="dataChanged()">
          <mat-option *ngFor="let item of fundRaiseStageCodes$ | async" [value]="item.lookup_code">{{item.lookup_value}}</mat-option>
        </mat-select>
      </mat-form-field>
      <div style="margin-bottom: 20px">
        <mat-form-field style="width: 100%">
          <textarea matInput style="min-height: 20px"  placeholder="Comment" [(ngModel)]="prospect.fund_raise_stage_comment" cdkTextareaAutosize (ngModelChange)="dataChanged()"></textarea>
        </mat-form-field>
      </div>
      <div style="display: flex; justify-content: flex-end;">
        <button mat-button class="btn mat-flat-button" (click)="saveProspect()">SUBMIT</button>
      </div>
    </div>
  </mat-expansion-panel>
</mat-accordion>
